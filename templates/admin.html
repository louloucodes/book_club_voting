{% extends "base.html" %}

{% block title %}Admin Panel{% endblock %}

{% block content %}
    <h1>Admin Panel</h1>

    <div class="admin-section">
        <h2>Add a New Book</h2>
        <form id="add-book-form" class="book-form">
            <div class="form-group">
                <label for="title">Book Title</label>
                <input type="text" id="title" name="title" required>
            </div>
            <div class="form-group">
                <label for="author">Author</label>
                <input type="text" id="author" name="author" required>
            </div>
            <div class="form-group">
                <label for="suggested_by">Suggested by</label>
                <input type="text" id="suggested_by" name="suggested_by">
            </div>
            <button type="submit" class="submit-button">Add Book</button>
        </form>
        <div id="form-message" class="form-message"></div>
    </div>

    <div class="admin-section">
        <h2>Manage Existing Books</h2>
        <p class="instructions">Drag and drop to reorder the books.</p>
        <!-- MODIFIED: The list now uses the .book-item structure -->
        <ul id="manage-book-list">
            {% for book in books %}
            <li class="book-item" data-id="{{ book.id }}" id="manage-item-{{ book.id }}">
                <span class="drag-handle">&#x2630;</span>
                <div class="book-cover">
                    {% if book.cover_image_url %}
                        <img src="{{ book.cover_image_url }}" alt="Cover of {{ book.title }}">
                    {% else %}
                        <div class="cover-placeholder">No Image</div>
                    {% endif %}
                </div>
                <div class="book-info">
                    <h2 class="book-title">{{ book.title }}</h2>
                    <p class="book-author">by {{ book.author }}</p>
                    <!-- MODIFIED: Use 'published_date' to match the Book object -->
                    <p class="book-publication-date">Published: {{ book.published_date }}</p>
                </div>
                {% if config.SHOW_SUGGESTER %}
                <div class="book-suggester">
                    <p>Suggested by:</p>
                    <strong>{{ book.suggested_by }}</strong>
                </div>
                {% endif %}
                <button class="delete-button" data-id="{{ book.id }}">&times;</button>
            </li>
            {% endfor %}
        </ul>
        <button id="save-order-button" class="submit-button" style="display: none;">Save New Order</button>
        <div id="order-message" class="form-message"></div>
    </div>
{% endblock %}

{% block scripts %}
    <!-- MODIFIED: Load main.js as a module. It will import SortableJS itself. -->
    <script type="module" src="{{ url_for('static', filename='js/main.js') }}"></script>
{% endblock %}